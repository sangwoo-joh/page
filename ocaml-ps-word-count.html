<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="google-site-verification" content="fgTBOMeN_sdI4JNBqYTzDwH0458H8AAVbF78jLjwudg" />
  <script type="text/javascript" src="/assets/vendor/moment.min.js"></script>
  <script type="text/javascript" src="/assets/js/site.js"></script>
  <!-- <script src="https://unpkg.com/cursor-effects@latest/dist/browser.js"></script> -->

  <title>
    
      OCaml로 PS 하기 -2-
    
  </title>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="OCaml로 PS 하기 -2-" />
<meta name="author" content="sangwoo-joh" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="최애 언어 OCaml 로 문제를 풀어보자 두 번째 시리즈다." />
<meta property="og:description" content="최애 언어 OCaml 로 문제를 풀어보자 두 번째 시리즈다." />
<link rel="canonical" href="https://sangwoo-joh.github.io/ocaml-ps-word-count" />
<meta property="og:url" content="https://sangwoo-joh.github.io/ocaml-ps-word-count" />
<meta property="og:site_name" content="Caml Shaving" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-27T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="OCaml로 PS 하기 -2-" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"sangwoo-joh"},"dateModified":"2019-08-27T00:00:00+00:00","datePublished":"2019-08-27T00:00:00+00:00","description":"최애 언어 OCaml 로 문제를 풀어보자 두 번째 시리즈다.","headline":"OCaml로 PS 하기 -2-","mainEntityOfPage":{"@type":"WebPage","@id":"https://sangwoo-joh.github.io/ocaml-ps-word-count"},"url":"https://sangwoo-joh.github.io/ocaml-ps-word-count"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://sangwoo-joh.github.io/feed.xml" title="Caml Shaving" />

  <link rel="apple-touch-icon" sizes="57x57" href="https://sangwoo-joh.github.io/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://sangwoo-joh.github.io/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://sangwoo-joh.github.io/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://sangwoo-joh.github.io/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://sangwoo-joh.github.io/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://sangwoo-joh.github.io/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://sangwoo-joh.github.io/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://sangwoo-joh.github.io/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://sangwoo-joh.github.io/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="https://sangwoo-joh.github.io/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://sangwoo-joh.github.io/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="https://sangwoo-joh.github.io/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://sangwoo-joh.github.io/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="https://sangwoo-joh.github.io/assets/icons/manifest.json">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Ubuntu" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans" />
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <link rel="stylesheet" href="https://sangwoo-joh.github.io/assets/css/main.css" />
  <link rel="stylesheet" href="https://sangwoo-joh.github.io/assets/css/syntax.css" />
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J0C68FHJ6L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-J0C68FHJ6L');
</script>


</head>
<body a="auto">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="https://sangwoo-joh.github.io">/home/caml-shaving</a>
<center>
<h1>OCaml로 PS 하기 -2-</h1>
<h2>힘을 내.. OCaml</h2>
</center>

<div class="post-edit-date">
  
  2019-08-27
</div>

<div class="post-edit-date">
  
  
</div>

<em><p align="right">

태그:



<a href="/archive?tag=dev"><span class="tag">dev</span></a>





<a href="/archive?tag=ocaml"><span class="tag">ocaml</span></a>




</p></em>


<p>최애 언어 <a href="https://ocaml.org/">OCaml</a> 로 문제를 풀어보자 두 번째
 시리즈다.</p>

<h3 id="1152번-단어의-개수"><a href="https://www.acmicpc.net/problem/1152">1152번: 단어의 개수</a></h3>
<p>사실 이거 금방 풀었던 거라 자기 전에 가볍게 풀고 자려고 잡았다가 된통
 당했다.</p>

<p>문제 자체는 아주 심플하다. 길이 1,000,000 미만의 문자열 하나가 들어올
 건데, 대/소문자와 띄어쓰기만 담겨있고 문자열 앞뒤에는 공백이 있을 수
 있으며 연속된 공백은 없다. 이 경우 공백으로 구분되는 단어의 수를 세는
 문제다.</p>

<p>문자열 앞/뒤에 공백이 있는 경우를 제외하면 그냥 전체 <code class="language-plaintext highlighter-rouge">문자열의 공백
 수 + 1</code> 하면 되는 문제다. 앞뒤 공백만 처리해주면 된다.</p>

<p>하지만 OCaml은 함수형 접근이 가능한 친구! 나는 곧바로 다음과 같은
 함수를 짜기 시작했다. <code class="language-plaintext highlighter-rouge">Scanf.scanf</code>는 공백을 구분자로 인식하기 때문에
 공백이 포함된 긴 문자열을 입력으로 받을 수 없어서 이번에는 <code class="language-plaintext highlighter-rouge">read_line
 ()</code>을 썼다.</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">count_words</span> <span class="n">str</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">splited</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">split_on_char</span> <span class="k">'</span> <span class="k">'</span> <span class="n">str</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">filtered</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="p">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">splited</span> <span class="k">in</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">length</span> <span class="n">filtered</span>

<span class="k">let</span> <span class="n">solve</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="n">print_int</span> <span class="p">(</span><span class="n">count_words</span> <span class="n">input</span><span class="p">)</span>

<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">solve</span> <span class="bp">()</span>
</code></pre></div></div>

<p>가독성을 위해서 중간 변수를 썼을 뿐이지 사실 한 줄로도 가능한
 코드이다. <code class="language-plaintext highlighter-rouge">String.split_on_char</code> 를 이용해서 공백을 기준으로 다
 쪼개버리고, 길이 0 인 (즉 공백인) 친구들을 필터링 하고 남는 단어
 리스트의 길이를 돌려주는, 아주 명확한 함수다. 예전에 애먹였던 테스트
 케이스들 (e.g. “ a “ 라던가, “ a” 라던가, “a “ 라던가, “” 라던가…)
 도 로컬에서 잘 통과했기에 문제없이 풀었다고 생각하고 제출했다.</p>

<p>그러자 <strong>런타임 오류</strong>가 떠버렸다.</p>

<p><img src="/assets/img/kejang_what.jpg" alt="what?" /></p>

<p>아니 <em>메모리 초과</em>나 <em>시간 초과</em>가 아니라 런타임 오류..? 오답도
 아니고 런타임 오류라고? 타입-안전한 우리 OCaml 친구가?  내가 놓친
 코너 케이스가 있는 것인가? 싶어서 1 시간 이상을 요리조리 디버깅
 해보고, 채점에 사용된 버전인 4.07.0 버전 소스도 받아다 뜯어보았으나
 <code class="language-plaintext highlighter-rouge">String.split_on_char</code> 에서 unsafe C FFI를 사용하는 부분이 수상하다는
 것외에는 딱히 소득이 없었다. 사실 야근하고 와서 졸린 머리로는 깊이
 파보고 싶지 않았다.</p>

<p>그래서 결국 함수형 접근은 포기하고 다음처럼 짜서 통과하긴 했다 (…)</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">to_array</span> <span class="n">str</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">arr</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">make</span> <span class="p">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">str</span><span class="p">)</span> <span class="k">'</span> <span class="k">'</span> <span class="k">in</span>
  <span class="nn">String</span><span class="p">.</span><span class="n">iteri</span> <span class="p">(</span><span class="k">fun</span> <span class="n">idx</span> <span class="n">ch</span> <span class="o">-&gt;</span> <span class="n">arr</span><span class="o">.</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">ch</span><span class="p">)</span> <span class="n">str</span> <span class="p">;</span>
  <span class="n">arr</span>

<span class="k">let</span> <span class="n">solve</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">to_array</span> <span class="n">input</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">count</span> <span class="o">=</span>
    <span class="nn">Array</span><span class="p">.</span><span class="n">fold_left</span> <span class="p">(</span><span class="k">fun</span> <span class="n">acc</span> <span class="n">at</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">at</span> <span class="o">=</span> <span class="k">'</span> <span class="k">'</span> <span class="k">then</span> <span class="n">acc</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">acc</span><span class="p">)</span> <span class="mi">0</span> <span class="n">arr</span>
  <span class="k">in</span>
  <span class="k">let</span> <span class="n">first</span><span class="o">,</span> <span class="n">last</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">,</span> <span class="n">arr</span><span class="o">.</span><span class="p">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">arr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">count</span> <span class="o">=</span>
    <span class="k">match</span> <span class="p">(</span><span class="n">first</span><span class="o">,</span> <span class="n">last</span><span class="p">)</span> <span class="k">with</span>
    <span class="o">|</span> <span class="k">'</span> <span class="k">'</span><span class="o">,</span> <span class="k">'</span> <span class="k">'</span> <span class="o">-&gt;</span>
        <span class="n">count</span> <span class="o">-</span> <span class="mi">2</span>
    <span class="o">|</span> <span class="k">'</span> <span class="k">'</span><span class="o">,</span> <span class="n">_</span> <span class="o">|</span> <span class="n">_</span><span class="o">,</span> <span class="k">'</span> <span class="k">'</span> <span class="o">-&gt;</span>
        <span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="o">|</span> <span class="n">_</span><span class="o">,</span> <span class="n">_</span> <span class="o">-&gt;</span>
        <span class="n">count</span>
  <span class="k">in</span>
  <span class="n">print_int</span> <span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">solve</span> <span class="bp">()</span>
</code></pre></div></div>

<p>이것도 처음엔 <code class="language-plaintext highlighter-rouge">String.to_seq</code> 가지고 짰는데, <code class="language-plaintext highlighter-rouge">Seq</code>가 in-place 변환이
 아니었다. (졸려서 깊이 파보진 않았으나) 뭔가 임의의 순서로 문자
 리스트를 정렬하는 바람에, ` a ` 를 입력으로 줫더니 <code class="language-plaintext highlighter-rouge">[| ' ', ' ', 'a'
 |]</code> 가 나와버렸고 이거 때문에 또 20 여분을 날린 것 같다 (…) 어쨌든
 (내 마음 속) 함수형 접근을 포기하고 대략 68ms 정도의 괜찮은 답안이
 통과되었다. Phew.</p>

<p>5분이면 풀고 잘 문제라고 생각없이 시작했다가 늦게 잠들게 되어
 버렸다. 역시 최애 언어이지만 마이너 언어로 PS를 도전하는 일은 만만치
 않다. 쉽게 풀었던 문제도 만만하게 보고 덤비지 말자.</p>

<h5 id="덧">덧.</h5>
<p>이쯤되면 거의 <a href="https://kkeun.net">끈닷넷</a> 님의 개인 과외가 되어
 가는 것 같은데 (…) 아무튼.</p>

<p>끈닷넷님의 덧글이 훨씬 빨라보인다. 한번 구현해보자. <code class="language-plaintext highlighter-rouge">String.trim</code>
 이란 함수가 있는지 몰랐다. 표준 라이브러리 문서를 좀더 꼼꼼하게
 읽어봐야겠다. 파이썬에도 <code class="language-plaintext highlighter-rouge">strip()</code> 이란 친구를 참 애용했는데 역시 내
 최애 언어다.</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">count_words</span> <span class="n">str</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">str</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">trim</span> <span class="n">str</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">spaces</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">0</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">count_space</span> <span class="n">ch</span> <span class="o">=</span> <span class="k">if</span> <span class="n">ch</span> <span class="o">=</span> <span class="k">'</span> <span class="k">'</span> <span class="k">then</span> <span class="n">incr</span> <span class="n">spaces</span> <span class="k">in</span>
  <span class="nn">String</span><span class="p">.</span><span class="n">iter</span> <span class="n">count_space</span> <span class="n">str</span> <span class="p">;</span>
  <span class="o">!</span><span class="n">spaces</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">let</span> <span class="n">solve</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">input</span> <span class="o">=</span> <span class="n">read_line</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="n">print_int</span> <span class="p">(</span><span class="n">count_words</span> <span class="n">input</span><span class="p">)</span>

<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="n">solve</span> <span class="bp">()</span>
</code></pre></div></div>

<p>깔끔하다. <code class="language-plaintext highlighter-rouge">String.trim</code> 으로 앞뒤 공백을 잘 제거했고 남은건 그냥
 공백만 세면 된다.</p>

<p>그런데 이대로 제출하니 <strong>오답</strong>이다. 아니? 맞왜틀? 다시 찬찬히
 살펴보니 빈 문자가 들어오는 경우를 처리해주지
 않았구나. <code class="language-plaintext highlighter-rouge">count_words</code>에 한 줄만 추가하면 된다.</p>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">count_words</span> <span class="n">str</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">str</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">trim</span> <span class="n">str</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">spaces</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">0</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">count_space</span> <span class="n">ch</span> <span class="o">=</span> <span class="k">if</span> <span class="n">ch</span> <span class="o">=</span> <span class="k">'</span> <span class="k">'</span> <span class="k">then</span> <span class="n">incr</span> <span class="n">spaces</span> <span class="k">in</span>
  <span class="nn">String</span><span class="p">.</span><span class="n">iter</span> <span class="n">count_space</span> <span class="n">str</span> <span class="p">;</span>
  <span class="k">if</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">str</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">!</span><span class="n">spaces</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></div>

<p>이것으로 최종 24ms의 답안에 성공했다. 예이!</p>


<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<br />

<div>
  <script src="https://giscus.app/client.js"
          data-repo="sangwoo-joh/reactions"
          data-repo-id="R_kgDOJFNVQw"
          data-category="Comments"
          data-category-id="DIC_kwDOJFNVQ84CUox9"
          data-mapping="pathname"
          data-strict="1"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="light_high_contrast"
          data-lang="ko"
          data-loading="lazy"
          crossorigin="anonymous"
          async>
  </script>
</div>

<br />

      </div>
    </main>

    
    <footer>
  <a href="/feed.xml">rss</a>
  <a href="mailto:work.sangwoo.joh@gmail.com">mail</a>
  <a href="https://www.linkedin.com/in/sangwoo-joh">linkedin</a>
  <a href="https://github.com/sangwoo-joh">github</a>
  <p class="copyright text-muted">Copyright &copy; sangwoo-joh 2023</p>
  <small><a target="_blank" href="https://icons8.com/icons/set/--camel">Camel icon</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a></small>
</footer>

  </body>
</html>
